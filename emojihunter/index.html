<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Emoji Hunter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Silkscreen&display=swap" rel="stylesheet">

  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
    }

    body {
      font-family: 'Silkscreen', monospace;
      background: #46424E;
      color: white;
      text-align: center;
      -webkit-tap-highlight-color: transparent;
    }

    /* Use dynamic viewport height on mobile (fixes centering issues) */
    #game-area {
      position: relative;
      width: 100vw;
      height: 100vh;   /* fallback */
      height: 100dvh;  /* modern mobile viewport */
      background-color: #B19090;
      overflow: hidden;
      touch-action: manipulation;
    }

    #score-board, #timer {
      position: absolute;
      top: 10px;
      font-size: 16px;
      z-index: 5;
    }
    #score-board { left: 10px; }
    #timer { right: 10px; }

    /*
      Reliable centering on mobile:
      - inset: 0 anchors to visible area
      - flex centers without transform weirdness
      - safe-area padding helps notches/home-indicator
    */
    .center-screen {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding:
        calc(16px + env(safe-area-inset-top))
        4vw
        calc(16px + env(safe-area-inset-bottom));
      z-index: 10;
    }

    /* constrain width inside centered overlays */
    .center-screen > * {
      max-width: 560px;
      width: 100%;
    }

    .big-title {
      font-size: 92px;
      line-height: 0.95;
      margin: 0 0 48px 0;
      letter-spacing: 2px;
    }

    .level-button,
    .play-again-button,
    .restart-button {
      background: #b80000;
      color: white;
      border: none;
      padding: 16px 22px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      margin: 6px;
      font-family: 'Silkscreen', monospace;
      touch-action: manipulation;
    }

    .level-button:hover,
    .play-again-button:hover,
    .restart-button:hover {
      background: #d00000;
    }

    #credit {
      margin-top: 28px;
      font-size: 16px;
    }
    #credit a {
      color: white;
      text-decoration: none;
    }

    .dot {
      position: absolute;
      width: 150px;
      height: 150px;
      font-size: 5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      cursor: pointer;
      user-select: none;
      z-index: 2;
    }

    #results {
      display: none;
      z-index: 20;
    }

    #results p {
      margin: 16px 0 24px;
      font-size: 16px;
    }

    /* Countdown */
    #countdown {
      display: none;
      z-index: 30;
      pointer-events: none;
    }

    #countdown-text {
      font-size: 140px;
      line-height: 1;
      user-select: none;
    }

    @media (max-width: 600px) {
      .big-title {
        font-size: 64px;
        margin-bottom: 36px;
      }

      .dot {
        width: 120px;
        height: 120px;
        font-size: 3rem;
      }

      #countdown-text {
        font-size: 96px;
      }
    }
  </style>
</head>

<body>
<div id="game-area">

  <!-- START -->
  <div id="level-buttons" class="center-screen">
    <h1 class="big-title">
      EM<span id="emoji-o">üê±</span>JI<br>
      H<span>üí£</span>NTER
    </h1>

    <div>
      <button class="level-button" id="easy-btn">üòπ Easy</button>
      <button class="level-button" id="medium-btn">üò∫ Medium</button><br>
      <button class="level-button" id="hard-btn">üòº Hard</button>
      <button class="level-button" id="super-btn">üôÄ Super</button>
    </div>

    <div id="credit">
      ¬© <a href="http://emojigames.se" target="_blank" rel="noopener noreferrer">EMOJI GAMES</a>
    </div>
  </div>

  <!-- HUD -->
  <div id="score-board" style="display:none;">To go: <span id="score">0</span></div>
  <div id="timer" style="display:none;">Time: <span id="time">30</span>s</div>

  <!-- COUNTDOWN -->
  <div id="countdown" class="center-screen">
    <div id="countdown-text">3</div>
  </div>

  <!-- GAME OVER -->
  <div id="results" class="center-screen">
    <h1 class="big-title">
      G<span>üí•</span>ME<br>
      OVER
    </h1>
    <p id="final-message"></p>
    <div>
      <button class="play-again-button" onclick="tryAgain()">Try Again</button>
      <button class="restart-button" onclick="goToStartScreen()">Change level</button>
    </div>
  </div>

</div>

<script>
  const gameArea = document.getElementById('game-area');
  const scoreBoard = document.getElementById('score-board');
  const timerBox = document.getElementById('timer');
  const scoreEl = document.getElementById('score');
  const timeEl = document.getElementById('time');
  const results = document.getElementById('results');
  const finalMessage = document.getElementById('final-message');
  const levelButtons = document.getElementById('level-buttons');
  const emojiO = document.getElementById('emoji-o');
  const countdownOverlay = document.getElementById('countdown');
  const countdownText = document.getElementById('countdown-text');

  const animalEmojis = ['üê∂','üê±','üê≠','üêπ','üê∞','ü¶ä','üêª','üêº','üêØ','ü¶Å','üêÆ','üê∑','üê∏','ü¶Ñ','üêµ','ü¶í','üêò','üê¥','üêó','ü¶ì'];

  /* CLICK SOUND ONLY */
  const clickSound = new Audio('click.mp3');
  clickSound.preload = 'auto';

  function playClick() {
    try {
      clickSound.currentTime = 0;
      clickSound.play();
    } catch {}
  }

  document.querySelectorAll('button').forEach(btn => {
    btn.addEventListener('click', playClick);
  });

  /* Logo emoji animation */
  let logoEmojiInterval;
  function startLogoEmoji() {
    emojiO.textContent = animalEmojis[Math.floor(Math.random() * animalEmojis.length)];
    logoEmojiInterval = setInterval(() => {
      emojiO.textContent = animalEmojis[Math.floor(Math.random() * animalEmojis.length)];
    }, 2000);
  }
  startLogoEmoji();

  let totalEmojis = 5;
  let remaining = 0;
  let timeLeft = 30;
  let timer = null;
  let gameFinished = false;
  let currentLevel = '';

  let countdownTimer = null;
  let isCountingDown = false;

  function clearDots() {
    document.querySelectorAll('.dot').forEach(d => d.remove());
  }

  function bounceDot(dot) {
    let x = parseFloat(dot.style.left) || 0;
    let y = parseFloat(dot.style.top) || 0;
    let dx = (Math.random() < 0.5 ? -1 : 1) * 4;
    let dy = (Math.random() < 0.5 ? -1 : 1) * 4;

    function move() {
      if (gameFinished || !dot.isConnected) return;

      const maxX = gameArea.clientWidth - dot.offsetWidth;
      const maxY = gameArea.clientHeight - dot.offsetHeight;

      x += dx;
      y += dy;

      if (x <= 0) { x = 0; dx = Math.abs(dx); }
      else if (x >= maxX) { x = maxX; dx = -Math.abs(dx); }

      if (y <= 0) { y = 0; dy = Math.abs(dy); }
      else if (y >= maxY) { y = maxY; dy = -Math.abs(dy); }

      dot.style.left = x + 'px';
      dot.style.top = y + 'px';

      requestAnimationFrame(move);
    }
    requestAnimationFrame(move);
  }

  function spawnBombs() {
    let count = currentLevel === 'Easy' ? 1 :
                currentLevel === 'Medium' ? 2 :
                currentLevel === 'Hard' ? 3 : 5;

    for (let i = 0; i < count; i++) {
      const bomb = document.createElement('div');
      bomb.className = 'dot';
      bomb.textContent = 'üí£';
      bomb.style.left = Math.random() * (gameArea.clientWidth - 150) + 'px';
      bomb.style.top = Math.random() * (gameArea.clientHeight - 150) + 'px';
      bomb.onclick = () => endGame();
      gameArea.appendChild(bomb);
      bounceDot(bomb);
    }
  }

  function startCountdownThenGame() {
    if (isCountingDown) return;

    results.style.display = 'none';
    countdownOverlay.style.display = 'none';

    levelButtons.style.display = 'none';
    scoreBoard.style.display = 'none';
    timerBox.style.display = 'none';

    clearInterval(logoEmojiInterval);

    countdownOverlay.style.display = 'flex';
    isCountingDown = true;

    let n = 3;
    countdownText.textContent = n;

    if (countdownTimer) clearInterval(countdownTimer);
    countdownTimer = setInterval(() => {
      n--;
      if (n > 0) {
        countdownText.textContent = n;
        return;
      }

      countdownText.textContent = 'GO!';
      clearInterval(countdownTimer);
      countdownTimer = null;

      setTimeout(() => {
        countdownOverlay.style.display = 'none';
        isCountingDown = false;
        startGame();
      }, 450);
    }, 1000);
  }

  function startGame() {
    gameFinished = false;
    clearDots();

    /* ‚úÖ FIX 1: Ensure overlays are hidden when a new game starts */
    results.style.display = 'none';
    countdownOverlay.style.display = 'none';

    gameArea.style.backgroundColor = '#B19090';

    scoreBoard.style.display = 'block';
    timerBox.style.display = 'block';

    remaining = totalEmojis;
    timeLeft = 30;
    scoreEl.textContent = remaining;
    timeEl.textContent = timeLeft;

    if (timer) clearInterval(timer);
    timer = setInterval(() => {
      timeLeft--;
      timeEl.textContent = timeLeft;
      if (timeLeft <= 0 || remaining <= 0) endGame();
    }, 1000);

    for (let i = 0; i < totalEmojis; i++) {
      const dot = document.createElement('div');
      dot.className = 'dot';
      dot.textContent = animalEmojis[Math.floor(Math.random() * animalEmojis.length)];
      dot.style.left = Math.random() * (gameArea.clientWidth - 150) + 'px';
      dot.style.top = Math.random() * (gameArea.clientHeight - 150) + 'px';

      dot.onclick = () => {
        dot.textContent = 'üí•';
        setTimeout(() => {
          if (!dot.isConnected) return;
          dot.remove();
          remaining--;
          scoreEl.textContent = remaining;
        }, 100);
      };

      gameArea.appendChild(dot);
      bounceDot(dot);
    }

    spawnBombs();
  }

  function endGame() {
    if (gameFinished) return;
    gameFinished = true;

    if (timer) clearInterval(timer);
    clearDots();

    scoreBoard.style.display = 'none';
    timerBox.style.display = 'none';

    results.style.display = 'flex';
    finalMessage.textContent =
      remaining === 0
        ? `You finished in ${30 - timeLeft} seconds!`
        : `You had ${remaining} emojis left.`;
  }

  function goToStartScreen() {
    if (timer) clearInterval(timer);
    if (countdownTimer) clearInterval(countdownTimer);

    isCountingDown = false;
    gameFinished = true;
    clearDots();

    countdownOverlay.style.display = 'none';
    results.style.display = 'none';

    levelButtons.style.display = 'flex';
    scoreBoard.style.display = 'none';
    timerBox.style.display = 'none';

    startLogoEmoji();
  }

  function tryAgain() {
    // fast loop: skip countdown
    startGame();
  }

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') goToStartScreen();
  });

  document.getElementById('easy-btn').onclick   = () => { totalEmojis = 5;  currentLevel = 'Easy'; startCountdownThenGame(); };
  document.getElementById('medium-btn').onclick = () => { totalEmojis = 10; currentLevel = 'Medium'; startCountdownThenGame(); };
  document.getElementById('hard-btn').onclick   = () => { totalEmojis = 15; currentLevel = 'Hard'; startCountdownThenGame(); };
  document.getElementById('super-btn').onclick  = () => { totalEmojis = 25; currentLevel = 'Super'; startCountdownThenGame(); };
</script>
</body>
</html>
